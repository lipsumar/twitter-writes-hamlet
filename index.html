<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Twitter writes Hamlet</title>
	<link href='https://fonts.googleapis.com/css?family=Crimson+Text' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" type="text/css" href="css/style.css?v=1460805323">
	<meta name="viewport" content="width=device-width, user-scalable=no">
	<script type="text/javascript" async src="https://platform.twitter.com/widgets.js"></script>
</head>
<body>
	<div class="app">
		<div class="app__top">
			<div class="hero">
				<h1 class="hero__text">Twitter writes Hamlet</h1>
			</div>

		</div>
		<div class="app__page">
			<div class="text">
				<div class="text__stage-direction" style="margin-top:3em">LOADING...</div>
			</div>

		</div>
		<div class="app__aside">
			<div class="hero hero--desktop">
				<h1 class="hero__text">Twitter writes Hamlet</h1>
			</div>
			<div class="about-text">
				<cite>“If you put 100 monkeys with typewriters in a room long enough, eventually you'll get Hamlet.”</cite>
				<p>This is the actual experiment, using a real-time feed of Twitter as the proveribial room of monkeys.</p>
				<p>Tweet the next word with the hashtag <a href="https://twitter.com/search?q=%23hamlet" class="hashtag">#hamlet</a> to continue the play!</p>
				<p class="cta-container">
					<a href="https://twitter.com/intent/tweet" target="_blank" class="cta">
						<svg xmlns="http://www.w3.org/2000/svg" width="25" viewBox="0 0 416 448" style="vertical-align:bottom">
							<path fill="#fff" d="M405 102q-16.75 24.5-40.5 41.75 0.25 3.5 0.25 10.5 0 32.5-9.5 64.875t-28.875 62.125-46.125 52.625-64.5 36.5-80.75 13.625q-67.75 0-124-36.25 8.75 1 19.5 1 56.25 0 100.25-34.5-26.25-0.5-47-16.125t-28.5-39.875q8.25 1.25 15.25 1.25 10.75 0 21.25-2.75-28-5.75-46.375-27.875t-18.375-51.375v-1q17 9.5 36.5 10.25-16.5-11-26.25-28.75t-9.75-38.5q0-22 11-40.75 30.25 37.25 73.625 59.625t92.875 24.875q-2-9.5-2-18.5 0-33.5 23.625-57.125t57.125-23.625q35 0 59 25.5 27.25-5.25 51.25-19.5-9.25 28.75-35.5 44.5 23.25-2.5 46.5-12.5z"></path>
						</svg>
						Tweet now
					</a>
				</p>

			</div>

			<div class="stats">
				<div class="stat__name">Experiment started:</div>
				<div class="stat__value">Sat Apr 16 2016 11:06:10</div>

				<div class="stat__name">Experiment running since:</div>
				<div class="stat__value"><span class="full-duration">---</span></div>

				<div class="stat__name">Words:</div>
				<div class="stat__value"><span class="word-count">--</span> / 32003<br>(<span class="word-count-pc">-%</span>)</div>
			</div>
		</div>

	</div>

	<div class="timeline">
		<div class="timeline__progress" style="width:0%"></div>
		<div class="timeline__text"><span class="word-count-pc"></span></div>
	</div>

</body>
</html>
	<script src="node_modules/jquery/dist/jquery.min.js"></script>
	<script src="node_modules/moment/min/moment.min.js"></script>
	<script src="/socket.io/socket.io.js"></script>
	<script>
var socket = io();

socket.on('state', function(resp){
	console.log(resp);
	var html = '';

	for (var i = 0; i < resp.htmlPieces.length; i++) {
		html+= resp.htmlPieces[i].html;
	}
	$('.text').html(html);
	$('.text').find('span').each(function(){
		var i = parseInt(this.getAttribute('data-i'), 10);
		if(i<resp.currentWordIndex){
			$(this).addClass('v');
		}
	});

	var $nextWord = getNextWord(resp.currentWordIndex-1);
	if($nextWord){
		$nextWord.addClass('looking');
	}


	// init stats
	refreshStats(resp);

	scrollText();

});
socket.on('word', function(resp){
	console.log('got index',resp.index);
	var $word = $('.text').find('span[data-i="'+resp.index+'"]');
	$word.removeClass('looking').addClass('v');
	var $nextWord = getNextWord(resp.index);
	if($nextWord){
		$nextWord.addClass('looking');
	}

	refreshStats(resp);

	scrollText();
});

function refreshStats(resp){
	var pc = ((resp.currentWordCount / 32003)*100).toFixed(2);
	$('.word-count').text(resp.currentWordCount);
	$('.word-count-pc').text(pc + '%');
	$('.timeline__progress').css('width', pc+'%');
}

function refreshTimer(){
	var duration = moment.duration( ( (new Date()).getTime()) - (new Date('Sat Apr 16 2016 11:06:10 GMT+0000 (UTC)').getTime()) );
	$('.full-duration').text(duration.humanize());
}
refreshTimer();
setInterval(refreshTimer, 60000);



$(window).on('resize', scrollText);

function getNextWord(index){
	var $nextWord,i=1;
	while(true){
		$nextWord = $('.text').find('span[data-i="'+(index+i)+'"]');
		if($nextWord.length===1) break;
		i++;
		if(i>50) break;
	}
	return $nextWord;
}




function keepTextScrolled(){
	scrollText();
	setTimeout(keepTextScrolled, 2000);
};
function scrollText(){
	var pageEl = $('.app__page')[0];
	pageEl.scrollTop = pageEl.scrollHeight;
}
keepTextScrolled();

	</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-1307649-14', 'auto');
  ga('send', 'pageview');

</script>
</body>
</html>